import java.util.concurrent.atomic.AtomicInteger
import java.util.function.Consumer
import java.util.function.Supplier

plugins {
    alias libs.plugins.takenaka
}

enableShadowPlugin()

sourceSets.main.java.srcDirs += 'src/generated/java'

dependencies {
    mappingBundle libs.takenaka.mappings
    implementation libs.takenaka.runtime
}

shadowJar {
    relocate 'me.kcra.takenaka.accessor', 'org.screamingsandals.lib.impl.ext.takenaka'
}

// after any changes in this file, please run the generateAccessors task to see changes in your ide

accessors {

    /*
    * TODO:
    *  1. Replace all incompatible typed/versioned names with either inferred request or standard request with return type
    *  2. Make sure this file works
    *  3. Validate against old configuration
    *  4. Update Slib
    *
    */

    // uncomment this and remove the mappingBundle dependency,
    // if you want to develop against custom versions
    /*versionRange('1.8.8', '1.20.4') {
        // exclude 1.16 and 1.10.1, they don't have most mappings and are basically not used at all
        // exclude 1.8.9, client-only update - no Spigot mappings, no thank you
        // exclude 1.9.1 and 1.9.3 - no mappings at all
        exclude '1.16', '1.10.1', '1.8.9', '1.9.1', '1.9.3'

        // include only releases, no snapshots
        includeTypes 'release'
    }*/

    basePackage 'org.screamingsandals.lib.impl.nms.accessors'
    accessedNamespaces 'spigot'
    accessorType 'reflection'

    var ResourceLocation = mapClass('net.minecraft.resources.ResourceLocation') {
        constructor(String)
    }

    var Component = mapClass('net.minecraft.network.chat.Component') {
        getter(String, 'coloredString') //method String, 'searge:func_150254_d' // get legacy string
    }

    var EntityType = mapClass('net.minecraft.world.entity.EntityType') {
        method(Optional, 'byString', String) // 1.14+
        method(it.name, 'searge:func_200713_a', String) // 1.13.X
        field('net.minecraft.util.registry.RegistryNamespaced', 'searge:field_191308_b') // 1.11 - 1.12.2 - map from resource location to class type
        field(Map, 'searge:field_75624_e') // <= 1.10.2

        field(Map, 'searge:field_75625_b') // <= 1.10.2 - map from string to class type
        method(Class, 'searge:func_201760_c') // 1.13.X - entity class type
        field('net.minecraft.world.entity.EntityType$EntityFactory', 'factory') // 1.14+ - factory method
    }

    var Registry = mapClass('net.minecraft.core.Registry') {
        field('net.minecraft.core.DefaultedRegistry', 'ENTITY_TYPE') // <= 1.19.2
        method(ResourceLocation, 'getId', Object)
    }

    var BuiltInRegistries = mapClass('net.minecraft.core.registries.BuiltInRegistries') {
        field('net.minecraft.core.DefaultedRegistry', 'ENTITY_TYPE')
    }

    var MappedRegistry = mapClass('net.minecraft.core.MappedRegistry') {
        method(int, 'searge:func_148757_b', Object)
        method(Object, 'get', ResourceLocation) // 1.13.1+
        method(Object, 'spigot:get', Object) // <= 1.13
    }

    var SynchedEntityData = mapClass('net.minecraft.network.syncher.SynchedEntityData') {
        method(Object, 'spigot:watch', int, Object) // 1.8.8 compat - bossbar - 1.8.8 ONLY method
    }

    var Level = mapClass('net.minecraft.world.level.Level') {
        getter(Supplier, 'profilerSupplier') // 1.17 and newer
        getter('net.minecraft.util.profiling.ProfilerFiller', 'profiler') // for something between new and old versions
        field('net.minecraft.server.VVV.MethodProfiler', 'methodProfiler') // for older versions, Spigot mapped
    }

    var Entity = mapClass('net.minecraft.world.entity.Entity') {
        method(SynchedEntityData, 'getEntityData') // DataWatcher
        method(Level, 'getCommandSenderWorld') // world
        method(double, 'getX')
        method(double, 'getY')
        method(double, 'getZ')
        method(float, 'getYRot')
        method(float, 'getXRot')
        method(EntityType, 'getType')
        method(int, 'getId')
        method(void, 'setNoGravity', boolean)
        method(boolean, 'isNoGravity')
        method(void, 'setOnGround', boolean)
        method(boolean, 'isOnGround')
        method(UUID, 'getUUID')
        method(void, 'setCustomNameVisible', boolean)
        method(boolean, 'isCustomNameVisible')
        method(void, 'setInvisible', boolean)
        method(boolean, 'isInvisible')
        method('net.minecraft.world.phys.Vec3', 'getDeltaMovement')
        method(void, 'searge:func_96094_a', String) // setCustomName
        method(void, 'setCustomName', Component)
        method(void, 'absMoveTo', double, double, double, float, float)
        method(Component, 'getCustomName')
        method(boolean, 'startRiding', it.name, boolean)
        method(void, 'stopRiding')
        field(double, 'searge:field_70159_w') // velocity x
        field(double, 'searge:field_70181_x') // velocity y
        field(double, 'searge:field_70179_y') // velocity z
        field(int, 'searge:field_70152_a')
        field(boolean, 'onGround')
        field(int, 'id')
        field(AtomicInteger, 'ENTITY_COUNTER')
        field(float, 'searge:field_70177_z') // yaw
        field(float, 'searge:field_70125_A') // pitch
        field(double, 'searge:field_70165_t') // locX
        field(double, 'searge:field_70163_u') // locY
        field(double, 'searge:field_70161_v') // locZ
        field(Level, 'searge:field_70170_p') // world
    }

    var InteractionHand = mapClass('net.minecraft.world.InteractionHand') {
        enumConstant('MAIN_HAND')
        enumConstant('OFF_HAND')
    }

    // 1.8.8 compat - Attributes (LivingEntity requires to be defined earlier)
    var Attribute = mapClass('net.minecraft.world.entity.ai.attributes.Attribute') {
        method(double, 'obfuscated:b:1.8.8')
    }

    var CombatTracker = mapClass('net.minecraft.world.damagesource.CombatTracker') {
        method(Component, 'getDeathMessage')
        method(void, 'recheckStatus')
    }

    var LivingEntity = mapClass('net.minecraft.world.entity.LivingEntity') { // 1.8.8 compat - BossBar
        method('net.minecraft.world.entity.ai.attributes.AttributeInstance', 'spigot:getAttributeInstance:1.8.8', Attribute) // 1.8.8 compat - Attributes
        field(int, 'removeArrowTime')
        method(int, 'getArrowCount')
        method(void, 'setArrowCount', int)
        method(boolean, 'doHurtTarget', Entity)
        method(void, 'swing', InteractionHand)
        method(float, 'getAbsorptionAmount')
        method(void, 'setAbsorptionAmount', float)
        method('net.minecraft.world.entity.ai.attributes.AttributeMap', 'getAttributes')
        method(CombatTracker, 'getCombatTracker')
    }

    var Mob = mapClass('net.minecraft.world.entity.Mob') {
        method(void, 'spigot:setAI', boolean) // 1.8.8
        method(boolean, 'spigot:hasAI') // 1.8.8
        method(void, 'setTarget', LivingEntity)
        method(LivingEntity, 'getTarget')

        field('net.minecraft.world.entity.ai.goal.GoalSelector', 'goalSelector')
        field('net.minecraft.world.entity.ai.goal.GoalSelector', 'targetSelector')
    }

    var PathfinderMob = mapClass('net.minecraft.world.entity.PathfinderMob')
    // end 1.8.8 compat


    var Component$Serializer = mapClass('net.minecraft.network.chat.Component$Serializer') {
        method(Component, 'searge:func_150699_a', String) // up to 1.15.2
        method('net.minecraft.network.chat.MutableComponent', 'searge:m_130701_', String) // 1.16.1+
    }

    var Rotations = mapClass('net.minecraft.core.Rotations') {
        constructor(float, float, float)
        method(float, 'getX')
        method(float, 'getY')
        method(float, 'getZ')
    }

    var Goal = mapClass('net.minecraft.world.entity.ai.goal.Goal') {
        method(boolean, 'canUse')
        method(boolean, 'canContinueToUse')
        method(void, 'start')
        method(void, 'stop')
        method(void, 'tick')

        method(EnumSet, 'getFlags') // >= 1.14
    }

    var Goal$Flag = mapClass('net.minecraft.world.entity.ai.goal.Goal$Flag') {
        enumConstant('TARGET')
    }

    var GoalSelector = mapClass('net.minecraft.world.entity.ai.goal.GoalSelector') {
        constructor(Supplier)

        field(Set, 'availableGoals') // 1.14+
        fieldChain {
            item(List, 'searge:field_75782_a')
            item(Set, 'searge:field_75782_a:1.8.8')
        }

        method(void, 'addGoal', int, Goal)
        method(void, 'removeGoal', Goal)
    }

    var WrappedGoal = mapClass('net.minecraft.world.entity.ai.goal.WrappedGoal') { // 1.14+
        getter(Goal, 'goal')
    }

    mapClass('spigot:PathfinderGoalSelector$PathfinderGoalSelectorItem') { // 1.8.8-1.13.2
        field(Goal, 'searge:field_75733_a')
    }

    // Goals
    mapClass('net.minecraft.world.entity.ai.goal.AvoidEntityGoal')
    mapClass('net.minecraft.world.entity.ai.goal.BegGoal')
    mapClass('net.minecraft.world.entity.ai.goal.BreakDoorGoal')
    mapClass('net.minecraft.world.entity.ai.goal.BreathAirGoal')
    mapClass('net.minecraft.world.entity.ai.goal.BreedGoal')
    mapClass('net.minecraft.world.entity.ai.goal.CatLieOnBedGoal')
    mapClass('net.minecraft.world.entity.ai.goal.CatSitOnBlockGoal')
    mapClass('net.minecraft.world.entity.ai.goal.ClimbOnTopOfPowderSnowGoal')
    mapClass('net.minecraft.world.entity.ai.goal.DolphinJumpGoal')
    mapClass('net.minecraft.world.entity.ai.goal.DoorInteractGoal')
    mapClass('net.minecraft.world.entity.ai.goal.EatBlockGoal')
    mapClass('net.minecraft.world.entity.ai.goal.FleeSunGoal')
    mapClass('net.minecraft.world.entity.ai.goal.FloatGoal') {
        constructor(Mob)
    }
    mapClass('net.minecraft.world.entity.ai.goal.FollowBoatGoal')
    mapClass('net.minecraft.world.entity.ai.goal.FollowFlockLeaderGoal')
    mapClass('net.minecraft.world.entity.ai.goal.FollowMobGoal')
    mapClass('net.minecraft.world.entity.ai.goal.FollowOwnerGoal')
    mapClass('net.minecraft.world.entity.ai.goal.FollowParentGoal')
    mapClass('net.minecraft.world.entity.ai.goal.GolemRandomStrollInVillageGoal')
    mapClass('net.minecraft.world.entity.ai.goal.InteractGoal')
    mapClass('net.minecraft.world.entity.ai.goal.JumpGoal')
    mapClass('net.minecraft.world.entity.ai.goal.LandOnOwnersShoulderGoal')
    mapClass('net.minecraft.world.entity.ai.goal.LeapAtTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.LlamaFollowCaravanGoal')
    mapClass('net.minecraft.world.entity.ai.goal.LookAtPlayerGoal')
    mapClass('net.minecraft.world.entity.ai.goal.LookAtTradingPlayerGoal')
    mapClass('net.minecraft.world.entity.ai.goal.MeleeAttackGoal') {
        constructor(PathfinderMob, double, boolean)
    }
    mapClass('net.minecraft.world.entity.ai.goal.MoveBackToVillageGoal')
    mapClass('net.minecraft.world.entity.ai.goal.MoveThroughVillageGoal')
    mapClass('net.minecraft.world.entity.ai.goal.MoveToBlockGoal')
    mapClass('net.minecraft.world.entity.ai.goal.MoveTowardsRestrictionGoal')
    mapClass('net.minecraft.world.entity.ai.goal.MoveTowardsTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.OcelotAttackGoal')
    mapClass('net.minecraft.world.entity.ai.goal.OfferFlowerGoal')
    mapClass('net.minecraft.world.entity.ai.goal.OpenDoorGoal')
    mapClass('net.minecraft.world.entity.ai.goal.PanicGoal')
    mapClass('net.minecraft.world.entity.ai.goal.PathfindToRaidGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RandomLookAroundGoal') {
        constructor(Mob)
    }
    mapClass('net.minecraft.world.entity.ai.goal.RandomStandGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RandomStrollGoal') {
        constructor(PathfinderMob, double)
    }
    mapClass('net.minecraft.world.entity.ai.goal.RandomSwimmingGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RangedAttackGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RangedBowAttackGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RangedCrossbowAttackGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RemoveBlockGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RestrictSunGoal')
    mapClass('net.minecraft.world.entity.ai.goal.RunAroundLikeCrazyGoal')
    mapClass('net.minecraft.world.entity.ai.goal.SitWhenOrderedToGoal')
    mapClass('net.minecraft.world.entity.ai.goal.StrollThroughVillageGoal')
    mapClass('net.minecraft.world.entity.ai.goal.SwellGoal')
    mapClass('net.minecraft.world.entity.ai.goal.TemptGoal')
    mapClass('net.minecraft.world.entity.ai.goal.TradeWithPlayerGoal')
    mapClass('net.minecraft.world.entity.ai.goal.TryFindWaterGoal')
    mapClass('net.minecraft.world.entity.ai.goal.UseItemGoal')
    mapClass('net.minecraft.world.entity.ai.goal.WaterAvoidingRandomFlyingGoal')
    mapClass('net.minecraft.world.entity.ai.goal.WaterAvoidingRandomStrollGoal')
    mapClass('net.minecraft.world.entity.ai.goal.ZombieAttackGoal')

    // Target goals
    mapClass('net.minecraft.world.entity.ai.goal.target.TargetGoal')

    mapClass('net.minecraft.world.entity.ai.goal.target.DefendVillageTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.target.HurtByTargetGoal') {
        constructor(PathfinderMob, Class[]) // 1.14+
        constructor(PathfinderMob, boolean, Class[]) // <= 1.13.2
    }
    mapClass('net.minecraft.world.entity.ai.goal.target.NearestAttackableTargetGoal') {
        constructor(Mob, Class, boolean) // 1.14+
        constructor(PathfinderMob, Class, boolean) // <= 1.13.2
    }
    mapClass('net.minecraft.world.entity.ai.goal.target.NearestAttackableWitchTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.target.NearestHealableRaiderTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.target.NonTameRandomTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.target.OwnerHurtByTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.target.OwnerHurtTargetGoal')
    mapClass('net.minecraft.world.entity.ai.goal.target.ResetUniversalAngerTargetGoal')

    mapClass('net.minecraft.world.entity.decoration.ArmorStand') {
        field('net.minecraft.network.syncher.EntityDataAccessor', 'DATA_CLIENT_FLAGS')
        field('net.minecraft.network.syncher.EntityDataAccessor', 'DATA_HEAD_POSE')
        constructor(Level, double, double, double)
        method(void, 'setSmall', boolean)
        method(boolean, 'isSmall')
        method(boolean, 'isShowArms')
        method(void, 'setShowArms', boolean)
        method(void, 'setNoBasePlate', boolean)
        method(boolean, 'isNoBasePlate')
        method(void, 'setMarker', boolean)
        method(boolean, 'isMarker')
    }

    mapClass('net.minecraft.world.entity.player.Player') {
        method(void, 'attack', Entity)
        method(void, 'removeEntitiesOnShoulder')
    }

    mapClass('net.minecraft.server.level.ServerPlayer') {
        field('net.minecraft.server.network.ServerGamePacketListenerImpl', 'connection')
        field(int, 'latency')
        method(void, 'setCamera', Entity)
        method(void, 'tellNeutralMobsThatIDied')
    }

    mapClass('net.minecraft.world.entity.projectile.FishingHook')

    mapClass('net.minecraft.world.entity.LightningBolt')

    var FriendlyByteBuf = mapClass('net.minecraft.network.FriendlyByteBuf') {
        constructor('io.netty.buffer.ByteBuf')
        method(it.name, 'writeNbt', 'net.minecraft.nbt.Tag') // 1.20.2+
        var frByteBuf = it.name
        methodChain {
            item(frByteBuf, 'writeNbt', 'net.minecraft.nbt.CompoundTag')
            item(void, 'searge:func_150786_a:1.8.8', 'net.minecraft.nbt.CompoundTag')
        } // <= 1.20.1
    }

    var Packet = mapClass('net.minecraft.network.protocol.Packet')

    mapClass('net.minecraft.network.protocol.game.ClientboundAnimatePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundBlockDestructionPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundBlockEventPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundBlockUpdatePacket')

    mapClass('net.minecraft.network.protocol.game.ClientboundCustomPayloadPacket') { // <= 1.20.1
        constructor(String, FriendlyByteBuf) // pre-1.13
        constructor(ResourceLocation, FriendlyByteBuf) // 1.13+
    }

    mapClass('net.minecraft.network.protocol.game.ClientboundContainerClosePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundPlayerAbilitiesPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundRemoveEntitiesPacket') {
        constructor(int[]) // 1.8.8 compat - bossbar
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundSetCameraPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetEntityLinkPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundTakeItemEntityPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundUpdateMobEffectPacket') {
        field(int, 'entityId')
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundSetEquipmentPacket') {
        field(int, 'entity')
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundRotateHeadPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundMoveEntityPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundMoveEntityPacket$Rot')
    mapClass('net.minecraft.network.protocol.game.ClientboundMoveEntityPacket$Pos')
    mapClass('net.minecraft.network.protocol.game.ClientboundMoveEntityPacket$PosRot')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetEntityDataPacket') {
        constructor(int, SynchedEntityData, boolean) // 1.8.8 compat - bossbar
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundEntityEventPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundTeleportEntityPacket') {
        constructor(Entity) // 1.8.8 compat - bossbar
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundSetEntityMotionPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetExperiencePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundExplodePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetCarriedItemPacket')

    mapClass('net.minecraft.network.protocol.game.ClientboundDisconnectPacket')

    mapClass('net.minecraft.network.protocol.game.ClientboundAddPlayerPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundOpenBookPacket') {
        constructor()
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundPlayerInfoPacket') // < 1.19.2
    mapClass('net.minecraft.network.protocol.game.ClientboundPlayerInfoUpdatePacket') // 1.19.3+
    mapClass('net.minecraft.network.protocol.game.ClientboundPlayerInfoRemovePacket') // 1.19.3+
    mapClass('net.minecraft.network.protocol.game.ClientboundTabListPacket') {
        constructor()
        constructor(Component, Component)
        field(Component, 'header')
        field(Component, 'footer')
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundRemoveMobEffectPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetDisplayObjectivePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetObjectivePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetScorePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundResetScorePacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundAddMobPacket') {
        constructor(LivingEntity) // 1.8.8 compat - bossbar
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundAddEntityPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundForgetLevelChunkPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetPlayerTeamPacket')
    mapClass('net.minecraft.network.protocol.game.ClientboundSetPlayerTeamPacket$Parameters')
    mapClass('net.minecraft.network.protocol.game.ClientboundHurtAnimationPacket')

    /* SPECTATOR start - Spigot implementation (no-legacy text) */
    // Titles <= 1.16.5
    var ClientboundSetTitlesPacket$Type = mapClass('net.minecraft.network.protocol.game.ClientboundSetTitlesPacket$Type') {
        enumConstant('TITLE')
        enumConstant('SUBTITLE')
        enumConstant('ACTIONBAR')
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundSetTitlesPacket') {
        constructor(int, int, int)
        constructor(ClientboundSetTitlesPacket$Type, Component)
    }
    // Titles >= 1.17
    mapClass('net.minecraft.network.protocol.game.ClientboundSetTitleTextPacket') {
        constructor(Component)
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundSetSubtitleTextPacket') {
        constructor(Component)
    }
    mapClass('net.minecraft.network.protocol.game.ClientboundSetTitlesAnimationPacket') {
        constructor(int, int, int)
    }
    /* SPECTATOR end */

    mapClass('net.minecraft.network.syncher.EntityDataSerializers')
    mapClass('net.minecraft.network.syncher.EntityDataAccessor') {
        method(int, 'getId')
    }

    mapClass('net.minecraft.world.level.GameType')

    var ServerboundInteractPacket$Action = mapClass('net.minecraft.network.protocol.game.ServerboundInteractPacket$Action') {
        enumConstant('ATTACK')
    }

    mapClass('net.minecraft.network.protocol.game.ServerboundInteractPacket') {
        field(int, 'entityId')
        field(ServerboundInteractPacket$Action, 'action')
        field(ServerboundInteractPacket$Action, 'ATTACK_ACTION')
    }

    mapClass('net.minecraft.network.syncher.EntityDataSerializers')

    var Item = mapClass('net.minecraft.world.item.Item') {
        method(int, 'getId', it.name)
    }

    // new way of getting protocol
    mapClass('net.minecraft.SharedConstants') {
        method(int, 'getProtocolVersion')
    }

    var ServerStatus$Version = mapClass('net.minecraft.network.protocol.status.ServerStatus$Version') {
//        method(chain('protocol', 'getProtocol')) // 1.19.4 - compatible change: ServerStatus$Version is now record, so the method got renamed
    }

    // old way of getting protocol
    var ServerStatus = mapClass('net.minecraft.network.protocol.status.ServerStatus') {
        method(ServerStatus$Version, 'getVersion') // -1.19.3
        method(Optional, 'version') // 1.19.4+ - incompatible change: the method now returns Optional instead of nullable object
    }

    var ServerConnectionListener = mapClass('net.minecraft.server.network.ServerConnectionListener') {
        field(List, 'channels')
        field(List, 'connections')
    }

    mapClass('net.minecraft.server.MinecraftServer') {
        field(ServerStatus, 'status')
        field(ServerConnectionListener, 'connection')
    }

    var BlockState = mapClass('net.minecraft.world.level.block.state.BlockState')

    mapClass('net.minecraft.world.level.block.Block') {
        method(int, 'getId', BlockState)
        method(BlockState, 'spigot:fromLegacyData', int)
    }

    mapClass('net.minecraft.network.protocol.PacketFlow') {
        enumConstant('SERVERBOUND')
        enumConstant('CLIENTBOUND')
    }

    mapClass('net.minecraft.network.ConnectionProtocol') {
        enumConstant('HANDSHAKING')
        enumConstant('PLAY')
        enumConstant('STATUS')
        enumConstant('LOGIN')
        field(Map, 'flows') // new
        field(Map, 'mojang:packets:1.14.4') // old
    }

    var ConnectionProtocol$PacketSet = mapClass('net.minecraft.network.ConnectionProtocol$PacketSet') {
        methodChain {
            item(Integer, 'getId', Class)
            item(int, 'getId', Class)
        } // 1.19.4: compatible change - return type changed from boxed Integer to primitive int
    }

    mapClass('net.minecraft.network.ConnectionProtocol$CodecData') { // 1.20.2+
        field(ConnectionProtocol$PacketSet, 'packetSet')
    }

    var Connection = mapClass('net.minecraft.network.Connection') {
        field('io.netty.channel.Channel', 'channel')
    }

    mapClass('net.minecraft.server.network.ServerGamePacketListenerImpl') {
        field(Connection, 'connection') // <= 1.20.1
        method(void, 'send', Packet) // <= 1.20.1
    }

    mapClass('net.minecraft.server.network.ServerCommonPacketListenerImpl') {
        field(Connection, 'connection') // 1.20.2+
        method(void, 'send', Packet) // 1.20.2+
    }

    mapClass('net.minecraft.core.Direction') {
        method(it.name, 'fromYRot', double)
    }

    var Tag = mapClass('net.minecraft.nbt.Tag') {
        method(String, 'getAsString')
    }

    mapClass('net.minecraft.nbt.ByteArrayTag') {
        constructor(byte[])
        method(byte[], 'getAsByteArray')
    }

    mapClass('net.minecraft.nbt.ByteTag') {
        constructor(byte)
        method(byte, 'getAsByte')
        method(it.name, 'valueOf', byte)
    }

    var CompoundTag = mapClass('net.minecraft.nbt.CompoundTag') {
        constructor()
        method(Set, 'getAllKeys')
        method(Tag, 'get', String)
        method(void, 'remove', String)

        var cmpTagName = it.name
        methodChain {
            item(cmpTagName, 'put', String, Tag)
            item(void, 'searge:func_74782_a:1.13.2', String, Tag)
        }
        methodChain {
            item(cmpTagName, 'merge', String, Tag)
            item(void, 'searge:func_179237_a:1.12.2', cmpTagName)
        } // 1.13 method returns `this` for chaining
    }

    FriendlyByteBuf.with {
    }

    mapClass('net.minecraft.nbt.DoubleTag') {
        constructor(double)
        method(double, 'getAsDouble')
        method(it.name, 'valueOf', double) // 1.15+
    }

    mapClass('net.minecraft.nbt.FloatTag') {
        constructor(float)
        method(float, 'getAsFloat')
        method(it.name, 'valueOf', float) // 1.15+
    }

    mapClass('net.minecraft.nbt.IntArrayTag') {
        constructor(int[])
        method(int[], 'getAsIntArray')
    }

    mapClass('net.minecraft.nbt.IntTag') {
        constructor(int)
        method(int, 'getAsInt')
        method(it.name, 'valueOf', int) // 1.15+
    }

    mapClass('net.minecraft.nbt.ListTag') {
        constructor()
        method('int', 'size')
        methodChain {
            item(Tag, 'get', int)
            item(Tag, 'searge:func_179238_g:1.12.2', int)
        }
        var ltTagName = it.name
        methodChain {
            item(ltTagName, 'spigot:add:1.13.2', Tag)
            item(void, 'spigot:add:1.12.2', Tag)
        } // <= 1.13.2
    }

    mapClass('net.minecraft.nbt.LongArrayTag') { // 1.12+
        constructor(long[])
        method(long[], 'getAsLongArray') // 1.13+
        field(long[], 'searge:field_193587_b:1.12') // 1.12.x
    }

    mapClass('net.minecraft.nbt.LongTag') {
        constructor(long)
        method(long, 'getAsLong')
        method(it.name, 'valueOf', long) // 1.15+
    }

    mapClass('net.minecraft.nbt.ShortTag') {
        constructor(short)
        method(short, 'getAsShort')
        method(it.name, 'valueOf', short) // 1.15+
    }

    mapClass('net.minecraft.nbt.StringTag') {
        constructor(String)
        method(it.name, 'valueOf', String) // 1.15+
    }


    mapClass('net.minecraft.world.item.ItemStack') {
        method(it.name, 'copy')
        method(void, 'save', CompoundTag)
        method(CompoundTag, 'getTag')
        method(void, 'setTag', CompoundTag)
    }

    // 1.10.x compat
    var EnumZombieType = mapClass('spigot:EnumZombieType') {
        enumConstant('spigot:HUSK')
    }

    mapClass('net.minecraft.world.entity.monster.Zombie') {
        method(void, 'spigot:setVillagerType', EnumZombieType)
        method(EnumZombieType, 'spigot:getVillagerType')
        enumConstant('obfuscated:a:1.8.8') // Attributes 1.8.8 support
    }

    /* 1.8.8 compat start */
    // Particles
    var EnumParticle = mapClass('spigot:EnumParticle') {
        method(it.name, 'obfuscated:a', int)
    }

    mapClass('net.minecraft.network.protocol.game.ClientboundLevelParticlesPacket') {
        constructor(EnumParticle, boolean, float, float, float, float, float, float, float, int, int[])
    }

    mapClass('net.minecraft.server.level.ServerLevel') {
        method(void, 'obfuscated:a:1.8.8', EnumParticle, boolean, double, double, double, int, double, double, double, double, int[])
    }

    // Attributes
    mapClass('net.minecraft.world.entity.monster.SharedMonsterAttributes') {
        enumConstantChain('spigot:maxHealth:1.8.8', 'MAX_HEALTH')
        enumConstant('spigot:FOLLOW_RANGE:1.8.8')
        enumConstant('obfuscated:c:1.8.8')
        enumConstant('spigot:MOVEMENT_SPEED:1.8.8')
        enumConstant('FLYING_SPEED')
        enumConstant('spigot:ATTACK_DAMAGE:1.8.8')
        enumConstant('ATTACK_SPEED')
        enumConstant('ARMOR')
        enumConstant('ARMOR_TOUGHNESS')
        enumConstant('LUCK')
    }

    mapClass('net.minecraft.world.entity.animal.horse.Horse') {
        enumConstant('spigot:attributeJumpStrength:1.8.8')
    }

    var AttributeModifier = mapClass('net.minecraft.world.entity.ai.attributes.AttributeModifier') {
        method(double, 'obfuscated:a:1.8.8') // amount
        method(int, 'obfuscated:b:1.8.8') // operation (ordered: 0,1,2)
        method(String, 'obfuscated:c:1.8.8') // name
        method(UUID, 'obfuscated:d:1.8.8') // unique id

        constructor(UUID, String, double, int)
    }

    mapClass('net.minecraft.world.entity.ai.attributes.AttributeInstance') {
        constructor(Attribute, Consumer)
        method(void, 'setBaseValue', double) // set base value
//
        method(Attribute, 'spigot:getAttribute:1.8.8') // attribute type
        method(double, 'obfuscated:b:1.8.8') // get base value
        method(List, 'obfuscated:c:1.8.8') // get modifiers
        method(void, 'obfuscated:b:1.8.8', AttributeModifier) // add modifier
        method(void, 'obfuscated:c:1.8.8', '@AttributeModifier') // remove modifier
        method(double, 'spigot:getValue:1.8.8') // get value
    }

    var AttributeSupplier = mapClass('net.minecraft.world.entity.ai.attributes.AttributeSupplier') {
        field(Attribute, 'instances')
    }

    mapClass('net.minecraft.world.entity.ai.attributes.AttributeMap') {
        method(void, 'registerAttribute', Attribute) // old
        // new
        field(AttributeSupplier, 'supplier')
    }


    // BossBars

    mapClass('net.minecraft.world.entity.boss.wither.WitherBoss') {
        constructor(Level)
    }

    mapClass('net.minecraft.world.entity.boss.enderdragon.EnderDragon') {
        constructor(Level)
        field(List, 'subEntities')
    }

    mapClass('spigot:PacketPlayOutChat') {
        constructor(Component, byte)
    }

    mapClass('net.minecraft.world.level.block.entity.BlockEntity') {
        method(void, 'setChanged')
    }

    mapClass('spigot:TileEntityFlowerPot') {
        method(void, 'searge:func_145964_a', Item, int)
        method(Item, 'spigot:getItem')
        method(byte, 'spigot:getData')
    }

    /* 1.8.8 compat end */

    mapClass('net.minecraft.world.entity.item.PrimedTnt') {
        field(LivingEntity, 'owner')
    }

    mapClass('net.minecraft.world.entity.EntityType$EntityFactory') {
        method(Object, 'create', ['@EntityType', '@Level'] as Object[])
    }
}
